# Flyland xQTL mapping scripts

###  Software requirements (you may need to install some of them if they are not already installed):

1. bwa mem
2. samtools
3. GATK
4. Picard tools
5. bedtools
6. A perl module Text::NSP::Measures::2D::Fisher::twotailed

### Script requirements:

1. fq_all2std.pl: a script I downloaded from the internet that converts base quality score to Sanger scale
2. pileupCov.pl: a script I wrote to convert mpileup output from samtools
3. filterVariants.pl: a script I wrote to filter variants detected in pools
4. bsaTest.R: a R script to perform the test for allele frequency difference

### File requirements:

1. reference genome and index and associated files, including the fai index (generated by samtools), GATK dictionary file (generated by picard)
2. freeze2.known.indel.vcf: needed to do indel realignment
3. freeze2.all.var.vcf: needed to do base recalibration

### Experiment specific requirements:

1. flyland.snp.bed (or flyland.ii.snp.bed for Flyland II): a bed file specifying the SNP sites and alleles (provided to the script with the --site option). This should be generated based on information about what lines were used to create the population. I have an example in the directory. Only sites in this file will be tested. This file can be downloaded from http://dgrp2.gnets.ncsu.edu/data.html
2. fastq.txt: a file to list locations and other information of fastq files (e.g. day4.female.fastq.txt in the directory). It is tab delimited with files including (1) read group id you wish to assign to the fastq (2) sample name for the fastq (2) lane ID for the fastq (3) PU or platform unit ID (4) “pair" or “single” end sequencing (5)** Illumina (I) or Sanger (S) scale Phred scores (6) file 1 of the pair (7) file of the pair, if any
3. --lg, --hg, these are command line options to tell the script to pool data within the same flags for the sample name field. In the example fastq list file, all data with FL4 are from a pool, and all with FH4 are from the other pool. So you should specify --lg FL4 and --hg FH4. 
4. --nchr1, --nchr2, numbers of chromosomes in --lg and --hg. This is used when doing the allele frequency test. You will need to find this out from whoever does the library construction.

### Example command

```
bash ~/software/scripts/flyland.sh --bwa ~/software/bwa-0.7.10/bwa --sam ~/software/samtools-0.1.18/samtools --gatk ~/software/GenomeAnalysisTK-2.4-9-g532efad/GenomeAnalysisTK.jar --bed ~/software/bedtools-2.17.0/bin/bedtools --picard ~/software/picard-tools-1.119/ --index ~/storage/flybase/fb-r5.57/dmel.bwa0710 --ref ~/storage/flybase/fb-r5.57/dmel-all-chromosome-r5.57 --conv ~/software/scripts/fq_all2std.pl --pileup ~/software/scripts/pileupCov.pl --filter ~/software/scripts/filterVariants.pl --stat ~/software/scripts/bsaTest.R --fastq day4.female.fastq.txt --indel ~/storage/flybase/fb-r5.57/freeze2.known.indel.vcf --var ~/storage/flybase/fb-r5.57/freeze2.all.vcf --tmp /storage2/whuang9/tmp/ --ncpu 8 --lg FL4 --hg FH4 --site ~/storage/mareFlyland/flyland.snp.bed --nchr1 200 --nchr2 200 > day4.female.log 2>&1 &
```

